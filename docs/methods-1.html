<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Methods | Applications of Machine Learning in Imputation</title>
  <meta name="description" content="This document presents the findings from the 2018/19 project into the use of machine learning in imputation." />
  <meta name="generator" content="bookdown 0.10.1 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Methods | Applications of Machine Learning in Imputation" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This document presents the findings from the 2018/19 project into the use of machine learning in imputation." />
  <meta name="github-repo" content="Vinayak-NZ/ML-Imputation" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Methods | Applications of Machine Learning in Imputation" />
  
  <meta name="twitter:description" content="This document presents the findings from the 2018/19 project into the use of machine learning in imputation." />
  

<meta name="author" content="Vinayak Anand-Kumar" />


<meta name="date" content="2019-01-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="xgboost.html">
<link rel="next" href="results.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><p style="text-align:center;"><img src="images/open.png" style="width:100px;height:100px"></p></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="what-is-imputation.html"><a href="what-is-imputation.html"><i class="fa fa-check"></i><b>2</b> What is Imputation?</a><ul>
<li class="chapter" data-level="2.1" data-path="what-is-imputation.html"><a href="what-is-imputation.html#why-is-imputation-carried-out"><i class="fa fa-check"></i><b>2.1</b> Why is imputation carried out?</a></li>
<li class="chapter" data-level="2.2" data-path="what-is-imputation.html"><a href="what-is-imputation.html#methods"><i class="fa fa-check"></i><b>2.2</b> Methods</a><ul>
<li class="chapter" data-level="2.2.1" data-path="what-is-imputation.html"><a href="what-is-imputation.html#interactive-treatment"><i class="fa fa-check"></i><b>2.2.1</b> Interactive treatment</a></li>
<li class="chapter" data-level="2.2.2" data-path="what-is-imputation.html"><a href="what-is-imputation.html#deductive-imputation"><i class="fa fa-check"></i><b>2.2.2</b> Deductive imputation</a></li>
<li class="chapter" data-level="2.2.3" data-path="what-is-imputation.html"><a href="what-is-imputation.html#model-based-imputation"><i class="fa fa-check"></i><b>2.2.3</b> Model based imputation</a></li>
<li class="chapter" data-level="2.2.4" data-path="what-is-imputation.html"><a href="what-is-imputation.html#donor-based-imputation"><i class="fa fa-check"></i><b>2.2.4</b> Donor based imputation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html"><i class="fa fa-check"></i><b>3</b> What is Machine Learning?</a><ul>
<li class="chapter" data-level="3.1" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html#supervision"><i class="fa fa-check"></i><b>3.1</b> Supervision</a><ul>
<li class="chapter" data-level="3.1.1" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html#supervised-learning"><i class="fa fa-check"></i><b>3.1.1</b> Supervised learning</a></li>
<li class="chapter" data-level="3.1.2" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html#unsupervised-learning"><i class="fa fa-check"></i><b>3.1.2</b> Unsupervised learning</a></li>
<li class="chapter" data-level="3.1.3" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html#semi-supervised-learning"><i class="fa fa-check"></i><b>3.1.3</b> Semi-supervised learning</a></li>
<li class="chapter" data-level="3.1.4" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html#reinforcement-learning"><i class="fa fa-check"></i><b>3.1.4</b> Reinforcement learning</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html#batch-and-online-learning"><i class="fa fa-check"></i><b>3.2</b> Batch and Online learning</a><ul>
<li class="chapter" data-level="3.2.1" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html#batch-learning"><i class="fa fa-check"></i><b>3.2.1</b> Batch learning</a></li>
<li class="chapter" data-level="3.2.2" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html#online-learning"><i class="fa fa-check"></i><b>3.2.2</b> Online learning</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html#approaches-to-generalisation"><i class="fa fa-check"></i><b>3.3</b> Approaches to generalisation</a><ul>
<li class="chapter" data-level="3.3.1" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html#instance-based-learning"><i class="fa fa-check"></i><b>3.3.1</b> Instance-based learning</a></li>
<li class="chapter" data-level="3.3.2" data-path="what-is-machine-learning.html"><a href="what-is-machine-learning.html#model-based-learning"><i class="fa fa-check"></i><b>3.3.2</b> Model-based learning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="why-use-machine-learning.html"><a href="why-use-machine-learning.html"><i class="fa fa-check"></i><b>4</b> Why use Machine Learning?</a></li>
<li class="chapter" data-level="5" data-path="xgboost.html"><a href="xgboost.html"><i class="fa fa-check"></i><b>5</b> XGBoost</a><ul>
<li class="chapter" data-level="5.1" data-path="xgboost.html"><a href="xgboost.html#decision-trees"><i class="fa fa-check"></i><b>5.1</b> Decision trees</a><ul>
<li class="chapter" data-level="5.1.1" data-path="xgboost.html"><a href="xgboost.html#boosting"><i class="fa fa-check"></i><b>5.1.1</b> Boosting</a></li>
<li class="chapter" data-level="5.1.2" data-path="xgboost.html"><a href="xgboost.html#building-models-with-xgboost"><i class="fa fa-check"></i><b>5.1.2</b> Building models with XGBoost</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="methods-1.html"><a href="methods-1.html"><i class="fa fa-check"></i><b>6</b> Methods</a><ul>
<li class="chapter" data-level="6.1" data-path="methods-1.html"><a href="methods-1.html#census-teaching-file"><i class="fa fa-check"></i><b>6.1</b> Census Teaching File</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>7</b> Results</a><ul>
<li class="chapter" data-level="7.1" data-path="results.html"><a href="results.html#summary-statistics"><i class="fa fa-check"></i><b>7.1</b> Summary statistics</a></li>
<li class="chapter" data-level="7.2" data-path="results.html"><a href="results.html#comparison-of-imputation-methods"><i class="fa fa-check"></i><b>7.2</b> Comparison of imputation methods</a><ul>
<li class="chapter" data-level="7.2.1" data-path="results.html"><a href="results.html#economic-activity"><i class="fa fa-check"></i><b>7.2.1</b> Economic Activity</a></li>
<li class="chapter" data-level="7.2.2" data-path="results.html"><a href="results.html#hours-worked"><i class="fa fa-check"></i><b>7.2.2</b> Hours worked</a></li>
<li class="chapter" data-level="7.2.3" data-path="results.html"><a href="results.html#social-grade"><i class="fa fa-check"></i><b>7.2.3</b> Social Grade</a></li>
<li class="chapter" data-level="7.2.4" data-path="results.html"><a href="results.html#student"><i class="fa fa-check"></i><b>7.2.4</b> Student</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="next-steps.html"><a href="next-steps.html"><i class="fa fa-check"></i><b>8</b> Next steps</a></li>
<li class="chapter" data-level="9" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>9</b> Resources</a><ul>
<li class="chapter" data-level="9.1" data-path="resources.html"><a href="resources.html#r-scripts"><i class="fa fa-check"></i><b>9.1</b> R scripts</a></li>
<li class="chapter" data-level="9.2" data-path="resources.html"><a href="resources.html#data"><i class="fa fa-check"></i><b>9.2</b> Data</a></li>
<li class="chapter" data-level="9.3" data-path="resources.html"><a href="resources.html#xgboost-1"><i class="fa fa-check"></i><b>9.3</b> XGBoost</a></li>
<li class="chapter" data-level="9.4" data-path="resources.html"><a href="resources.html#donor-imputation"><i class="fa fa-check"></i><b>9.4</b> Donor imputation</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applications of Machine Learning in Imputation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="methods-1" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Methods</h1>
<p>The project evaluated the machine learning methods using:</p>
<ol style="list-style-type: decimal">
<li>The Census Teaching File, an open data set containing 1% of the person records from the 2011 Census in England &amp; Wales.<br />
</li>
<li>Survey Data</li>
</ol>
<div id="census-teaching-file" class="section level2">
<h2><span class="header-section-number">6.1</span> Census Teaching File</h2>
<p>The Census Teaching File was downloaded from the <a href="https://www.ons.gov.uk/census/2011census/2011censusdata/censusmicrodata/microdatateachingfile">ONS website</a> as a CSV file named “CensusTeachingFile”, and was read into R using the following line of code. The data set consisted of 569,741 individuals and 18 categorical variables from the 2011 Census population.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Read CSV into R</span>
CensusRaw &lt;-<span class="st"> </span><span class="kw">read.csv</span>(
  <span class="dt">file =</span> <span class="st">&quot;data/source/CensusTeachingFile.csv&quot;</span>, <span class="dt">skip =</span> <span class="dv">1</span>,
  <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>
)</code></pre></div>
<p>The code below specifies the packages used in the preparation, study and build of machine learning systems using the Census Teaching File.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(mice)
<span class="kw">library</span>(reshape2)
<span class="kw">library</span>(GGally)
<span class="kw">library</span>(Matrix)
<span class="kw">library</span>(xgboost)
<span class="kw">library</span>(caret)
<span class="kw">library</span>(DiagrammeR)
<span class="kw">library</span>(MLmetrics)
<span class="kw">library</span>(rpart)
<span class="kw">library</span>(scales)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(kableExtra)
<span class="kw">library</span>(DescTools)
<span class="kw">library</span>(dummies)</code></pre></div>
<p>The steps below present the methods used to compare the performance of model based imputation (using XGBoost) with that of donor based imputation (using CANCEIS). Code chunks are provided to demonstrate how each step was carried out; with the imputable variable, economic activity, as the example.</p>
<ol style="list-style-type: decimal">
<li>Variables in the data set were renamed and recoded so that:</li>
</ol>
<ul>
<li>Variable names were consistent with <a href="https://google.github.io/styleguide/Rguide.xml">Google’s R style guide</a></li>
<li>The response categories for all variables were numeric</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rename variables</span>
Census &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">rename</span>(CensusRaw, <span class="kw">c</span>(
  <span class="st">&quot;Person.ID&quot;</span> =<span class="st"> &quot;person.id&quot;</span>,
  <span class="st">&quot;Region&quot;</span> =<span class="st"> &quot;region&quot;</span>,
  <span class="st">&quot;Residence.Type&quot;</span> =<span class="st"> &quot;residence.type&quot;</span>,
  <span class="st">&quot;Family.Composition&quot;</span> =<span class="st"> &quot;fam.comp&quot;</span>,
  <span class="st">&quot;Population.Base&quot;</span> =<span class="st"> &quot;resident.type&quot;</span>,
  <span class="st">&quot;Sex&quot;</span> =<span class="st"> &quot;sex&quot;</span>,
  <span class="st">&quot;Age&quot;</span> =<span class="st"> &quot;age&quot;</span>,
  <span class="st">&quot;Marital.Status&quot;</span> =<span class="st"> &quot;marital.status&quot;</span>,
  <span class="st">&quot;Student&quot;</span> =<span class="st"> &quot;student&quot;</span>,
  <span class="st">&quot;Country.of.Birth&quot;</span> =<span class="st"> &quot;birth.country&quot;</span>,
  <span class="st">&quot;Health&quot;</span> =<span class="st"> &quot;health&quot;</span>,
  <span class="st">&quot;Ethnic.Group&quot;</span> =<span class="st"> &quot;ethnicity&quot;</span>,
  <span class="st">&quot;Religion&quot;</span> =<span class="st"> &quot;religion&quot;</span>,
  <span class="st">&quot;Economic.Activity&quot;</span> =<span class="st"> &quot;econ.act&quot;</span>,
  <span class="st">&quot;Occupation&quot;</span> =<span class="st"> &quot;occupation&quot;</span>,
  <span class="st">&quot;Industry&quot;</span> =<span class="st"> &quot;industry&quot;</span>,
  <span class="st">&quot;Hours.worked.per.week&quot;</span> =<span class="st"> &quot;hours.worked&quot;</span>,
  <span class="st">&quot;Approximated.Social.Grade&quot;</span> =<span class="st"> &quot;social.grade&quot;</span>
))

<span class="co"># Recode variables (dataset is mutated in order to recode variables)</span>
Census &lt;-<span class="st"> </span>Census <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_if</span>(is.factor, as.character)

<span class="co"># Recode the Region variable so that it is numeric</span>
Census<span class="op">$</span>region[Census<span class="op">$</span>region <span class="op">==</span><span class="st"> &quot;E12000001&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span>
Census<span class="op">$</span>region[Census<span class="op">$</span>region <span class="op">==</span><span class="st"> &quot;E12000002&quot;</span>] &lt;-<span class="st"> </span><span class="dv">2</span>
Census<span class="op">$</span>region[Census<span class="op">$</span>region <span class="op">==</span><span class="st"> &quot;E12000003&quot;</span>] &lt;-<span class="st"> </span><span class="dv">3</span>
Census<span class="op">$</span>region[Census<span class="op">$</span>region <span class="op">==</span><span class="st"> &quot;E12000004&quot;</span>] &lt;-<span class="st"> </span><span class="dv">4</span>
Census<span class="op">$</span>region[Census<span class="op">$</span>region <span class="op">==</span><span class="st"> &quot;E12000005&quot;</span>] &lt;-<span class="st"> </span><span class="dv">5</span>
Census<span class="op">$</span>region[Census<span class="op">$</span>region <span class="op">==</span><span class="st"> &quot;E12000006&quot;</span>] &lt;-<span class="st"> </span><span class="dv">6</span>
Census<span class="op">$</span>region[Census<span class="op">$</span>region <span class="op">==</span><span class="st"> &quot;E12000007&quot;</span>] &lt;-<span class="st"> </span><span class="dv">7</span>
Census<span class="op">$</span>region[Census<span class="op">$</span>region <span class="op">==</span><span class="st"> &quot;E12000008&quot;</span>] &lt;-<span class="st"> </span><span class="dv">8</span>
Census<span class="op">$</span>region[Census<span class="op">$</span>region <span class="op">==</span><span class="st"> &quot;E12000009&quot;</span>] &lt;-<span class="st"> </span><span class="dv">9</span>
Census<span class="op">$</span>region[Census<span class="op">$</span>region <span class="op">==</span><span class="st"> &quot;W92000004&quot;</span>] &lt;-<span class="st"> </span><span class="dv">10</span>

Census<span class="op">$</span>residence.type[Census<span class="op">$</span>residence.type <span class="op">==</span><span class="st"> &quot;C&quot;</span>] &lt;-<span class="st"> </span><span class="dv">0</span>
Census<span class="op">$</span>residence.type[Census<span class="op">$</span>residence.type <span class="op">==</span><span class="st"> &quot;H&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span>

Census<span class="op">$</span>student[Census<span class="op">$</span>student <span class="op">==</span><span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">0</span>
Census<span class="op">$</span>student[Census<span class="op">$</span>student <span class="op">==</span><span class="st"> </span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">1</span>

Census<span class="op">$</span>sex[Census<span class="op">$</span>sex <span class="op">==</span><span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">0</span>
Census<span class="op">$</span>sex[Census<span class="op">$</span>sex <span class="op">==</span><span class="st"> </span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">1</span>

Census<span class="op">$</span>birth.country[Census<span class="op">$</span>birth.country<span class="op">==</span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">0</span>
Census<span class="op">$</span>birth.country[Census<span class="op">$</span>birth.country<span class="op">==</span><span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">1</span>

Census &lt;-<span class="st"> </span>Census <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_if</span>(is.character, as.numeric)

Census<span class="op">$</span>person.id &lt;-<span class="st"> </span><span class="kw">as.character</span>(Census<span class="op">$</span>person.id)

Ht &lt;-<span class="st"> </span><span class="kw">table</span>(Census<span class="op">$</span>hours.worked)
Census<span class="op">$</span>hours.cont &lt;-<span class="st"> </span><span class="kw">ifelse</span>(Census<span class="op">$</span>hours.worked <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="kw">runif</span>(
  <span class="dv">1</span><span class="op">:</span>Ht[<span class="kw">names</span>(Ht) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>],
  <span class="dv">1</span>, <span class="dv">15</span>
),
<span class="kw">ifelse</span>(Census<span class="op">$</span>hours.worked <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, <span class="kw">runif</span>(<span class="dv">1</span><span class="op">:</span>Ht[<span class="kw">names</span>(Ht) <span class="op">==</span><span class="st"> </span><span class="dv">2</span>], <span class="dv">16</span>, <span class="dv">30</span>),
  <span class="kw">ifelse</span>(Census<span class="op">$</span>hours.worked <span class="op">==</span><span class="st"> </span><span class="dv">3</span>, <span class="kw">runif</span>(<span class="dv">1</span><span class="op">:</span>Ht[<span class="kw">names</span>(Ht) <span class="op">==</span><span class="st"> </span><span class="dv">3</span>], <span class="dv">31</span>, <span class="dv">48</span>),
    <span class="kw">ifelse</span>(Census<span class="op">$</span>hours.worked <span class="op">==</span><span class="st"> </span><span class="dv">4</span>, <span class="kw">runif</span>(<span class="dv">1</span><span class="op">:</span>Ht[<span class="kw">names</span>(Ht) <span class="op">==</span><span class="st"> </span><span class="dv">4</span>], <span class="dv">49</span>, <span class="dv">60</span>),
      Census<span class="op">$</span>hours.worked
    )
  )
)
)

<span class="kw">save</span>(Census, <span class="dt">file =</span> <span class="st">&quot;data/core/Census.Rda&quot;</span>)

Census.pre.ohe &lt;-<span class="st"> </span>Census

<span class="co"># Prepare Census data for one hot encoding</span>
Census.pre.ohe<span class="op">$</span>fam.comp[Census.pre.ohe<span class="op">$</span>fam.comp <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">9</span>] &lt;-<span class="st"> &quot;NCR&quot;</span>

Census.pre.ohe<span class="op">$</span>health[Census.pre.ohe<span class="op">$</span>health <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">9</span>] &lt;-<span class="st"> &quot;NCR&quot;</span>

Census.pre.ohe<span class="op">$</span>ethnicity[Census.pre.ohe<span class="op">$</span>ethnicity <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">9</span>] &lt;-<span class="st"> &quot;NCR&quot;</span>

Census.pre.ohe<span class="op">$</span>religion[Census.pre.ohe<span class="op">$</span>religion <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">9</span>] &lt;-<span class="st"> &quot;NCR&quot;</span>

Census.pre.ohe<span class="op">$</span>econ.act[Census.pre.ohe<span class="op">$</span>econ.act <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">9</span>] &lt;-<span class="st"> &quot;NCR&quot;</span>

Census.pre.ohe<span class="op">$</span>occupation[Census.pre.ohe<span class="op">$</span>occupation <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">9</span>] &lt;-<span class="st"> &quot;NCR&quot;</span>

Census.pre.ohe<span class="op">$</span>industry[Census.pre.ohe<span class="op">$</span>industry <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">9</span>] &lt;-<span class="st"> &quot;NCR&quot;</span>

Census.pre.ohe<span class="op">$</span>social.grade[Census.pre.ohe<span class="op">$</span>social.grade <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">9</span>] &lt;-<span class="st"> &quot;NCR&quot;</span></code></pre></div>
<p>A preview of the data set is provided below.</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
person.id
</th>
<th style="text-align:right;">
region
</th>
<th style="text-align:right;">
residence.type
</th>
<th style="text-align:right;">
fam.comp
</th>
<th style="text-align:right;">
resident.type
</th>
<th style="text-align:right;">
sex
</th>
<th style="text-align:right;">
age
</th>
<th style="text-align:right;">
marital.status
</th>
<th style="text-align:right;">
student
</th>
<th style="text-align:right;">
birth.country
</th>
<th style="text-align:right;">
health
</th>
<th style="text-align:right;">
ethnicity
</th>
<th style="text-align:right;">
religion
</th>
<th style="text-align:right;">
econ.act
</th>
<th style="text-align:right;">
occupation
</th>
<th style="text-align:right;">
industry
</th>
<th style="text-align:right;">
hours.worked
</th>
<th style="text-align:right;">
social.grade
</th>
<th style="text-align:right;">
hours.cont
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
7394816
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
-9
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
-9.00000
</td>
</tr>
<tr>
<td style="text-align:left;">
7394745
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
52.97915
</td>
</tr>
<tr>
<td style="text-align:left;">
7395066
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
37.80685
</td>
</tr>
<tr>
<td style="text-align:left;">
7395329
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
39.52916
</td>
</tr>
<tr>
<td style="text-align:left;">
7394712
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
31.29265
</td>
</tr>
<tr>
<td style="text-align:left;">
7394750
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
31.04491
</td>
</tr>
</tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li>For the purposes of training and testing a machine learning system, the data was divided into training and test data sets using the following code.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Randomly select 80% of Census units and split into Train and Test data</span>
<span class="kw">set.seed</span>(<span class="dv">5</span>)
Census80 &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(Census_ohe), <span class="fl">0.8</span> <span class="op">*</span><span class="st"> </span><span class="kw">nrow</span>(Census_ohe), <span class="dt">replace =</span> <span class="ot">FALSE</span>)
Census20 &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(Census_ohe), Census80)

Census.train.ohe &lt;-<span class="st"> </span>Census_ohe[Census80, <span class="op">!</span>(<span class="kw">names</span>(Census_ohe)<span class="op">==</span><span class="st">&quot;hours.worked&quot;</span>)]
Census.test.ohe &lt;-<span class="st"> </span>Census_ohe[Census20, <span class="op">!</span>(<span class="kw">names</span>(Census_ohe)<span class="op">==</span><span class="st">&quot;hours.worked&quot;</span>)]

Census.train.label &lt;-<span class="st"> </span>Census[Census80, <span class="op">!</span>(<span class="kw">names</span>(Census)<span class="op">==</span><span class="st">&quot;hours.worked&quot;</span>)]
Census.test.label &lt;-<span class="st"> </span>Census[Census20, <span class="op">!</span>(<span class="kw">names</span>(Census)<span class="op">==</span><span class="st">&quot;hours.worked&quot;</span>)]

<span class="kw">save</span>(Census.train.ohe, <span class="dt">file =</span> <span class="st">&quot;data/ohe/Census.train.ohe.Rda&quot;</span>)
<span class="kw">save</span>(Census.test.ohe, <span class="dt">file =</span> <span class="st">&quot;data/ohe/Census.test.ohe.Rda&quot;</span>)

<span class="kw">save</span>(Census.train.label, <span class="dt">file =</span> <span class="st">&quot;data/label/Census.train.label.Rda&quot;</span>)
<span class="kw">save</span>(Census.test.label, <span class="dt">file =</span> <span class="st">&quot;data/label/Census.test.label.Rda&quot;</span>)</code></pre></div>
<p>The intention was to build models to predict a selection of variable using training data, which had no missingness. This model would then be evaluated with respect to its accuracy and generalisability using a test data set, which would have missingness. The Census Teaching File was a complete data set. As a result, missingness was simulated in the test data set, and the imputation models (derived for each variable) were evaluated with regards to how well they predicted the true values.</p>
<p>Models were tested for the following variables:<br />
- Economic activity (a multi-class variable) - Hours worked (a derived continuous variable)<br />
- Social Grade (a multi-class variable)<br />
- Student status (a binary variable) A more detailed description of all the variables can be found <a href="https://www.ons.gov.uk/census/2011census/2011censusdata/censusmicrodata/microdatateachingfile/variablelist">here</a>.</p>
<ol start="3" style="list-style-type: decimal">
<li>The distribution of the imputable variable was studied</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Study the variable: How many units in each category?</span>
EAt &lt;-<span class="st"> </span><span class="kw">table</span>(Census<span class="op">$</span>econ.act)

EAt

<span class="co"># What is the distribution of the variable: Remove NCR and plot to look at distribution</span>
g &lt;-<span class="st"> </span><span class="kw">ggplot</span>(Census[<span class="op">!</span>Census<span class="op">$</span>econ.act <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">9</span>, ], <span class="kw">aes</span>(econ.act))

g <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(
  <span class="dt">name =</span> <span class="st">&quot;Economic Activity&quot;</span>,
  <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()
)</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><p>The data set was cleaned for model training; the personal identifier and the categorical hours worked variable were removed. Moreover, units that were classified as no code required for the imputable variable were removed from the training and test data sets</p></li>
<li><p>Missingness was simulated in the test data set</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Purpose: Simulate missingness in one hot encoded dataset (with respect to imputable variable)</span>
<span class="co"># Input: Dataset without missingness</span>
<span class="co"># Output: Dataset with missingness</span>
<span class="co"># Parameters for the function are included below</span>
## dat: Name of input dataset
## ident: Name of unique identifier in the dataset
## var.aux: List of auxiliary variables in dataset
## ohe.vars: List of variables that have been one hot encoded
## imp.vars: List of imputable variables
## var: Name of imputable variable to have increased missingness for
## ohe: An indicator of whether imputable variable (in var) is one hot encoded
## exc: Exclude rows that are not eligible to answer imputable item
## crop: Exclude columns not eligible to answer imputable item (only eligible if imputable variable is one hot encoded)
SimMissV &lt;-<span class="st"> </span><span class="cf">function</span>(dat,ident,var.aux,ohe.vars,imp.vars,var,ohe,exc,drop){
  
  <span class="co"># Order dataset by identifier</span>
  dat &lt;-<span class="st"> </span>dat[<span class="kw">order</span>(dat[,<span class="kw">as.character</span>(ident)]),]
  
  <span class="co"># Remove all instances where imputable variable is NCR</span>
  <span class="cf">if</span>(ohe<span class="op">==</span><span class="dv">1</span>){
    dat.tidy &lt;-<span class="st"> </span><span class="kw">subset</span>(dat, <span class="op">!</span>(<span class="kw">grepl</span>(exc, dat[,drop])))
    dat.tidy &lt;-<span class="st"> </span>dat.tidy[,<span class="op">!</span><span class="kw">names</span>(dat.tidy)<span class="op">==</span>drop]
  } <span class="cf">else</span>{
    dat.tidy &lt;-<span class="st"> </span><span class="kw">subset</span>(dat, <span class="op">!</span>(<span class="kw">grepl</span>(exc, dat[,var])))
  }
  
  <span class="co"># Remove the personal identifier in order to stimulate missingness</span>
  person.id &lt;-<span class="st"> </span>dat.tidy[,<span class="kw">as.character</span>(ident)]
  dat.tidy &lt;-<span class="st"> </span>dat.tidy[, <span class="op">-</span><span class="dv">1</span>]
  
  <span class="co"># Subset dataset to auxiliary variables</span>
  dat.aux &lt;-<span class="st"> </span><span class="kw">sub.dat.ohe</span>(<span class="dt">dat=</span>dat.tidy, 
                                 <span class="dt">varlist=</span><span class="kw">c</span>(var.aux))
  
  <span class="co">#Setting up two missingness patterns for the auxiliary variables</span>
  <span class="co">#One pattern for core auxiliary variables</span>
  <span class="co">#One pattern for other auxiliary variables</span>
  pattern_core &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">28</span>), <span class="kw">rep</span>(<span class="dv">1</span>,<span class="dv">46</span>))
  pattern_oth &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>,<span class="dv">28</span>), <span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">46</span>))
  pattern_aux &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">rbind</span>(pattern_core, pattern_oth))
  
  dat.aux.amp &lt;-<span class="st"> </span><span class="kw">ampute</span>(dat.aux, <span class="dt">prop =</span> <span class="fl">0.4</span>, <span class="dt">mech =</span> <span class="st">&quot;MAR&quot;</span>, 
                                <span class="kw">set.seed</span>(<span class="dv">5</span>), <span class="dt">pattern=</span>pattern_aux, <span class="dt">freq=</span><span class="kw">c</span>(<span class="fl">0.2</span>,<span class="fl">0.8</span>))
  
  dat.aux.miss &lt;-<span class="st"> </span>dat.aux.amp<span class="op">$</span>amp
  
  instance_sub &lt;-<span class="st"> </span><span class="kw">setdiff</span>(imp.vars,var)
  
  <span class="co"># Subset data to mputable variables</span>
  dat.imp &lt;-<span class="st"> </span><span class="kw">sub.dat.ohe</span>(<span class="dt">dat=</span>dat.tidy, 
                                 <span class="dt">varlist=</span><span class="kw">c</span>(
                                   var,
                                   instance_sub))
  
  <span class="co">#Setting up two missingness patterns for the imputable variables</span>
  <span class="co">#One pattern for the imputable variable of interest</span>
  <span class="co">#One pattern for other imputable variables</span>
  iteration &lt;-<span class="st"> </span><span class="kw">select_vars</span>(<span class="kw">names</span>(dat.imp), <span class="kw">starts_with</span>(var, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>))
  
  pattern_pr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(iteration)), <span class="kw">rep</span>(<span class="dv">1</span>,<span class="kw">eval</span>(<span class="kw">ncol</span>(dat.imp)<span class="op">-</span><span class="kw">length</span>(iteration))))
  pattern_sc &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>,<span class="kw">length</span>(iteration)), <span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">eval</span>(<span class="kw">ncol</span>(dat.imp)<span class="op">-</span><span class="kw">length</span>(iteration))))
  pattern_imp &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">rbind</span>(pattern_pr, pattern_sc))
  
  dat.imp.amp &lt;-<span class="st"> </span><span class="kw">ampute</span>(dat.imp, <span class="dt">prop =</span> <span class="fl">0.5</span>, <span class="dt">mech =</span> <span class="st">&quot;MAR&quot;</span>, 
                                <span class="kw">set.seed</span>(<span class="dv">5</span>), <span class="dt">pattern=</span>pattern_imp, <span class="dt">freq=</span><span class="kw">c</span>(<span class="fl">0.8</span>,<span class="fl">0.2</span>))
  
  dat.imp.miss &lt;-<span class="st"> </span>dat.imp.amp<span class="op">$</span>amp
  
  dat.tidy.miss &lt;-<span class="st"> </span><span class="kw">cbind</span>(dat.imp.miss, dat.aux.miss)
  
  <span class="co"># Convert missing cases to -999</span>
  dat.tidy.miss[<span class="kw">is.na</span>(dat.tidy.miss)] &lt;-<span class="st"> </span><span class="op">-</span><span class="dv">999</span>
  
  instance_miss &lt;-<span class="st"> </span><span class="kw">setdiff</span>(ohe.vars,var)
    
  dat.tidy.miss &lt;-<span class="st"> </span><span class="kw">ohe.miss</span>(<span class="dt">dat=</span>dat.tidy.miss, 
                              <span class="dt">varlist=</span><span class="kw">c</span>(instance_miss))
  
  dat.miss &lt;-<span class="st"> </span><span class="kw">cbind</span>(person.id, dat.tidy.miss)
  
  <span class="co"># Return dataset with missingenss</span>
  <span class="kw">return</span>(dat.miss)
  
  
}</code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>A model was built using the training data and used to predict values in the test data</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Purpose: Train XGBoost model to impute variable</span>
<span class="co"># Input: Dataset with multiple auxiliary variables and single imputable variable </span>
<span class="co"># Output: Model for using auxiliary variables to predict imputable variable</span>
<span class="co"># Parameters for the function are included below</span>
## train: Name of training dataset
## test.orig: Name of test dataset without missingess
## test.miss: Name of test dataset with missingness simulated
## ident: Name of unique identifier in dataset
## cat: An indicator if imputable variable is categorical. cat = 1 if categorical and cat = 0 if continuous
## var: Name of imputable variable
## exc: Values of imputable variable to exclude from model training
## col_order: The order in which to arrange the features in the training and test matrices
## objective: The objective function to use in the XGBoost model
## max_depth: Maximum depth of trees for the XGBoost model
## eta: Learning rate for the XGBoost model
## nrounds: Number of rounds (i.e. trees) to use in the XGBoost model
## num_class: Number of classes in categorical variable + 1. Only use if imputable variable is categorical (i.e. if cat = 1)
trainDT &lt;-<span class="st"> </span><span class="cf">function</span>(train, test.orig, test.miss, ident, cat, var, exc, col_order,
                    objective, max_depth, eta, nrounds, num_class){
  ## ---- tidy-data
  <span class="co"># Sort all test datasets by identifier to ensure final comparison is valid</span>
  test.full &lt;-<span class="st"> </span>test.orig[<span class="kw">order</span>(test.orig[,<span class="kw">as.character</span>(ident)]),]
  
  test.miss &lt;-<span class="st"> </span>test.miss[<span class="kw">order</span>(test.miss[,<span class="kw">as.character</span>(ident)]),]
  
  <span class="co"># Tidy/treat the training and test datasets</span>
  <span class="co"># Remove units with NCR codes and remove the personal identifier</span>
  train.tidy &lt;-<span class="st"> </span><span class="kw">subset</span>(train, <span class="op">!</span>(<span class="kw">grepl</span>(exc, train[,var])), <span class="dt">select =</span> col_order)
  
  test.full.tidy &lt;-<span class="st"> </span><span class="kw">subset</span>(test.full, <span class="op">!</span>(<span class="kw">grepl</span>(exc, test.full[,var])), <span class="dt">select =</span> col_order)
  
  test.miss.tidy &lt;-<span class="st"> </span><span class="kw">subset</span>(test.miss, <span class="dt">select =</span> col_order)
  
  train.tidy &lt;-<span class="st"> </span>train.tidy[, col_order]
  
  test.full.tidy &lt;-<span class="st"> </span>test.full.tidy[, col_order]
  
  test.miss.tidy &lt;-<span class="st"> </span>test.miss.tidy[, col_order]
  
  ## ---- missingness-examine
  <span class="co"># Study the test dataset with missingness: How much missingness per variable?</span>
  NumberMissing &lt;-<span class="st"> </span><span class="kw">sapply</span>(test.miss.tidy, <span class="cf">function</span>(y) <span class="kw">sum</span>(<span class="kw">length</span>(
    <span class="kw">which</span>((y)<span class="op">==-</span><span class="dv">999</span>)
  )))
  
  TestNumberMissing &lt;-<span class="st"> </span><span class="kw">data.frame</span>(NumberMissing)
  
  ## ---- train-model
  <span class="co"># Train the model</span>
  <span class="co"># Convert the data to matrix and assign output variable</span>
  train.outcome &lt;-<span class="st"> </span>train.tidy[,var]
  
  train.ex &lt;-<span class="st"> </span>train.tidy[,<span class="op">!</span>(<span class="kw">names</span>(train.tidy)<span class="op">==</span>var)]
  
  train.predictors &lt;-<span class="st"> </span><span class="kw">sparse.model.matrix</span>(train.tidy[,var] <span class="op">~</span><span class="st"> </span>.,
                                          <span class="dt">data =</span> train.ex
  )[, <span class="op">-</span><span class="dv">1</span>]
  
  test.outcome &lt;-<span class="st"> </span>test.miss.tidy[,var]
  
  test.ex &lt;-<span class="st"> </span>test.miss.tidy[,<span class="op">!</span>(<span class="kw">names</span>(test.miss.tidy)<span class="op">==</span>var)]
  
  test.predictors &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(test.miss.tidy[,var] <span class="op">~</span><span class="st"> </span>.,
                                  <span class="dt">data =</span> test.ex
  )[, <span class="op">-</span><span class="dv">1</span>]
  
  <span class="co"># Convert the matrix objects to DMatrix objects</span>
  dtrain &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(train.predictors, <span class="dt">label =</span> train.outcome)
  
  dtest &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(test.predictors, <span class="dt">missing =</span> <span class="op">-</span><span class="dv">999</span>)
  
  <span class="co"># Train a model using training set</span>
  <span class="cf">if</span>(objective <span class="op">==</span><span class="st"> &quot;multi:softmax&quot;</span>){
    model &lt;-<span class="st"> </span><span class="kw">xgboost</span>(
      <span class="dt">data =</span> dtrain, <span class="dt">max_depth =</span> max_depth, <span class="dt">eta =</span> eta, <span class="dt">nthread =</span> <span class="dv">2</span>, <span class="dt">nrounds =</span> nrounds,
      <span class="dt">objective =</span> <span class="st">&quot;multi:softmax&quot;</span>, <span class="dt">num_class =</span> num_class, <span class="dt">missing =</span> <span class="op">-</span><span class="dv">999</span>
    )
  } <span class="cf">else</span> <span class="cf">if</span> (objective <span class="op">==</span><span class="st"> &quot;reg:linear&quot;</span>){
    model &lt;-<span class="st"> </span><span class="kw">xgboost</span>(
      <span class="dt">data =</span> dtrain, <span class="dt">max_depth =</span> max_depth, <span class="dt">eta =</span> eta, <span class="dt">nthread =</span> <span class="dv">2</span>, <span class="dt">nrounds =</span> nrounds,
      <span class="dt">objective =</span> <span class="st">&quot;reg:linear&quot;</span>, <span class="dt">missing=</span><span class="op">-</span><span class="dv">999</span>
    )
  } <span class="cf">else</span> {
    model &lt;-<span class="st"> </span><span class="kw">xgboost</span>(
      <span class="dt">data =</span> dtrain, <span class="dt">max_depth =</span> max_depth, <span class="dt">eta =</span> eta, <span class="dt">nthread =</span> <span class="dv">2</span>, <span class="dt">nrounds =</span> nrounds,
      <span class="dt">objective =</span> <span class="st">&quot;reg:logistic&quot;</span>, <span class="dt">missing=</span><span class="op">-</span><span class="dv">999</span>
    )
  }

  <span class="co"># Examine feature importance</span>
  importance_matrix &lt;-<span class="st"> </span><span class="kw">xgb.importance</span>(<span class="dt">model =</span> model)
  
  <span class="kw">print</span>(importance_matrix)
  
  plot.matrix &lt;-<span class="st"> </span><span class="kw">xgb.plot.importance</span>(<span class="dt">importance_matrix =</span> importance_matrix)
  
  ## ---- test-model
  <span class="co"># Test the model</span>
  <span class="cf">if</span>(objective<span class="op">==</span><span class="st">&quot;reg:logistic&quot;</span>){
  predicted &lt;-<span class="st"> </span><span class="kw">ifelse</span>(
    <span class="kw">predict</span>(model, dtest, <span class="dt">missing =</span> <span class="op">-</span><span class="dv">999</span>, <span class="dt">na.action =</span> na.pass) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)
  } <span class="cf">else</span> {
  predicted &lt;-<span class="st"> </span><span class="kw">predict</span>(model, dtest, <span class="dt">missing =</span> <span class="op">-</span><span class="dv">999</span>, <span class="dt">na.action =</span> na.pass)
  }
  
  ## ---- eval-model
  <span class="co"># Evaluate performance of XGBoost model</span>
  <span class="co"># Compare versions of the outcome variable (Actual, Predicted, Missing)</span>
  
  <span class="cf">if</span>(cat<span class="op">==</span><span class="dv">1</span>){
    actuals &lt;-<span class="st"> </span>test.full.tidy[,var]
    
    missing &lt;-<span class="st"> </span>test.miss.tidy[,var]
    
    compareVar &lt;-<span class="st"> </span><span class="kw">tibble</span>(
      <span class="dt">Actuals =</span> actuals, <span class="dt">Predictions =</span> predicted,
      <span class="dt">Missing =</span> missing
    )
    
    compareVar<span class="op">$</span>PI &lt;-<span class="st"> </span><span class="kw">ifelse</span>(compareVar<span class="op">$</span>Missing<span class="op">==-</span><span class="dv">999</span>, 
                            compareVar<span class="op">$</span>Predictions,
                            compareVar<span class="op">$</span>Actuals)
    
    compareMissing &lt;-<span class="st"> </span>compareVar[compareVar<span class="op">$</span>Missing <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">999</span>, ]
    
    compareMissing<span class="op">$</span>indicator &lt;-<span class="st"> </span><span class="kw">ifelse</span>(compareMissing<span class="op">$</span>Actuals <span class="op">==</span>
<span class="st">                                         </span>compareMissing<span class="op">$</span>Predictions,<span class="st">&quot;Correct&quot;</span>, <span class="st">&quot;Wrong&quot;</span>)
    
    output &lt;-<span class="st"> </span><span class="kw">list</span>(TestNumberMissing, 
                   model,
                   importance_matrix,
                   plot.matrix,
                   predicted,
                   compareVar,
                   compareMissing)
    
  } <span class="cf">else</span>{
    actuals &lt;-<span class="st"> </span>test.full.tidy[,var]
    
    missing &lt;-<span class="st"> </span>test.miss.tidy[,var]
    
    compareVar &lt;-<span class="st"> </span><span class="kw">tibble</span>(
      <span class="dt">Actuals =</span> actuals, <span class="dt">Predictions =</span> predicted,
      <span class="dt">Missing =</span> missing)
    
    compareVar<span class="op">$</span>PI &lt;-<span class="st"> </span><span class="kw">ifelse</span>(compareVar<span class="op">$</span>Missing<span class="op">==-</span><span class="dv">999</span>, 
                            compareVar<span class="op">$</span>Predictions,
                            compareVar<span class="op">$</span>Actuals)
    
    compareMissing &lt;-<span class="st"> </span>compareVar[compareVar<span class="op">$</span>Missing <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">999</span>, ]
    
    <span class="co"># Using Mean Absolute Error and Root Mean Square error to evaluate predictions</span>
    MAE_XG &lt;-<span class="st"> </span><span class="kw">MAE</span>(compareMissing<span class="op">$</span>Predictions,compareMissing<span class="op">$</span>Actuals)
    
    RMSE_XG &lt;-<span class="st"> </span><span class="kw">RMSE</span>(compareMissing<span class="op">$</span>Predictions,compareMissing<span class="op">$</span>Actuals)
    
    output &lt;-<span class="st"> </span><span class="kw">list</span>(TestNumberMissing, 
                   model,
                   importance_matrix,
                   plot.matrix,
                   predicted,
                   compareVar,
                   compareMissing,
                   MAE_XG,
                   RMSE_XG)
    
  }
  
  <span class="kw">return</span>(output)
  
}</code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Predictions from the test data were evaluated using graphs and quality metrics</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Save feature importance plot</span>
<span class="kw">png</span>(<span class="dt">filename=</span><span class="st">&quot;images/featuresXG_econAct.png&quot;</span>)
<span class="kw">xgb.plot.importance</span>(<span class="dt">importance_matrix =</span> econAct[[<span class="dv">3</span>]])
<span class="kw">dev.off</span>()

<span class="co"># Examine quality metrics</span>
compareMissing &lt;-<span class="st"> </span>econAct[[<span class="dv">7</span>]]

counts &lt;-<span class="st"> </span><span class="kw">table</span>(compareMissing<span class="op">$</span>indicator)

counts.melt &lt;-<span class="st"> </span><span class="kw">melt</span>(counts)

counts.melt<span class="op">$</span>Outcome &lt;-<span class="st"> </span>counts.melt<span class="op">$</span>Var1

accuracy_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>counts.melt, <span class="kw">aes</span>(<span class="dt">x=</span>Outcome, <span class="dt">y=</span>value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Accuracy of Predictions: XGBoost&quot;</span>)

accuracy_plot

<span class="kw">ggsave</span>(<span class="st">&quot;images/accuracyXG_econAct.png&quot;</span>)

confusion_XGBoost &lt;-<span class="st"> </span><span class="kw">confusionMatrix</span>(
  <span class="kw">factor</span>(compareMissing<span class="op">$</span>Actuals, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>),
  <span class="kw">factor</span>(compareMissing<span class="op">$</span>Predictions, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>)
)

<span class="kw">qplot</span>(Actuals, Predictions,
      <span class="dt">data =</span> compareMissing,
      <span class="dt">geom =</span> <span class="kw">c</span>(<span class="st">&quot;jitter&quot;</span>), <span class="dt">main =</span> <span class="st">&quot;XGBoost: predicted vs. observed in test data&quot;</span>,
      <span class="dt">xlab =</span> <span class="st">&quot;Observed Class&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Predicted Class&quot;</span>
) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;3&quot;</span>,<span class="st">&quot;4&quot;</span>,<span class="st">&quot;5&quot;</span>,<span class="st">&quot;6&quot;</span>,<span class="st">&quot;7&quot;</span>,<span class="st">&quot;8&quot;</span>,<span class="st">&quot;9&quot;</span>)
) <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_discrete</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;3&quot;</span>,<span class="st">&quot;4&quot;</span>,<span class="st">&quot;5&quot;</span>,<span class="st">&quot;6&quot;</span>,<span class="st">&quot;7&quot;</span>,<span class="st">&quot;8&quot;</span>,<span class="st">&quot;9&quot;</span>))

<span class="kw">ggsave</span>(<span class="st">&quot;images/EAXGBoostqplot.png&quot;</span>)

<span class="co"># What is the distribution of the variable before and after imputation</span>
Compare_val &lt;-<span class="st"> </span>econAct[[<span class="dv">6</span>]]

actuals &lt;-<span class="st"> </span><span class="kw">ggplot</span>(econAct[[<span class="dv">6</span>]], <span class="kw">aes</span>(Actuals))

actuals <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;True Distribution&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_discrete</span>(
    <span class="dt">name =</span> <span class="st">&quot;Economic Activity&quot;</span>,
    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()
  )

<span class="kw">ggsave</span>(<span class="st">&quot;images/actuals_socialGrade.png&quot;</span>)

actuals &lt;-<span class="st"> </span><span class="kw">table</span>(Compare_val<span class="op">$</span>Actuals)

actuals &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(actuals)

actuals &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">rename</span>(actuals, <span class="kw">c</span>(
  <span class="st">&quot;Var1&quot;</span> =<span class="st"> &quot;econ.act&quot;</span>,
  <span class="st">&quot;Freq&quot;</span> =<span class="st"> &quot;actuals&quot;</span>))

imputed &lt;-<span class="st"> </span><span class="kw">table</span>(Compare_val<span class="op">$</span>PI)

imputed &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(imputed)

imputed &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">rename</span>(imputed, <span class="kw">c</span>(
  <span class="st">&quot;Var1&quot;</span> =<span class="st"> &quot;econ.act&quot;</span>,
  <span class="st">&quot;Freq&quot;</span> =<span class="st"> &quot;imputed&quot;</span>))

plot.dat &lt;-<span class="st"> </span><span class="kw">merge</span>(actuals, imputed, <span class="dt">by =</span> <span class="st">&quot;econ.act&quot;</span>)

plot.dat.melt &lt;-<span class="st"> </span><span class="kw">melt</span>(plot.dat, <span class="dt">id=</span><span class="st">&quot;econ.act&quot;</span>)

plot.dat.melt &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">rename</span>(plot.dat.melt, <span class="kw">c</span>(
  <span class="st">&quot;variable&quot;</span> =<span class="st"> &quot;output&quot;</span>))

predictions &lt;-<span class="st"> </span><span class="kw">ggplot</span>(plot.dat.melt, <span class="kw">aes</span>(<span class="dt">x=</span>econ.act,<span class="dt">y=</span>value,<span class="dt">fill=</span>output)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>)

predictions <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Post Imputation: XGBoost&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_discrete</span>(
    <span class="dt">name =</span> <span class="st">&quot;Economic Activity&quot;</span>, 
    <span class="dt">breaks =</span> <span class="kw">pretty_breaks</span>()
  )

<span class="kw">ggsave</span>(<span class="st">&quot;images/PIXG_econAct.png&quot;</span>)

<span class="co"># Save model</span>
trainEA_v1 &lt;-<span class="st"> </span>econAct[[<span class="dv">2</span>]]

<span class="kw">xgb.save</span>(trainEA_v1, <span class="st">&quot;models/XGBoost/xgboost.econAct&quot;</span>)

<span class="co"># Save predicted values</span>
predicted.econAct &lt;-<span class="st"> </span>econAct[[<span class="dv">5</span>]]

<span class="kw">save</span>(predicted.econAct, <span class="dt">file =</span> <span class="st">&quot;data/predicted/XGBoost/predicted.econAct.RData&quot;</span>)</code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Donor based imputation was carried out on the test data (with missingness):
<ol style="list-style-type: lower-roman">
<li>CANCEIS: One round of CANCEIS selected matching variables based on a correlation matrix. Variables that had a correlation coefficient of |0.4| or greater were included as matching variables in the CANCEIS imputation specification. All variables were given the same weight.<br />
</li>
<li>Mixed Methods: One round of CANCEIS selected matching variables based on the feature importance figures from the XGBoost model. The six most important variables from the feature importance output were selected as matching variables; with more important variables assigned a larger weight.</li>
</ol></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Purpose: Create a CANCEIS input dataset with matching variables for a singe imputable variable</span>
<span class="co"># Input: Dataset with multiple auxiliary variables and single imputable variable </span>
<span class="co"># Output: Dataset with most highly correlated auxiliary variables and single imputable variable</span>
<span class="co"># Parameters for the function are included below</span>
## dat.cor: Name of dataset to use to derive correlation coefficients between imputable variable and auxiliary variables
## dat.miss: Name of dataset with missingness simulated
## var: Name of imputable variable
## exc: Exclusion condition for variables
## varlist: List of auxiliary variables to consider for selecting matching variables
CANCEIS.in &lt;-<span class="st"> </span><span class="cf">function</span>(dat.cor, dat.miss, var, exc, varlist) {

  dat.cor[dat.cor<span class="op">==</span>exc] &lt;-<span class="st"> </span><span class="ot">NA</span>
  
  dat.tidy &lt;-<span class="st"> </span><span class="kw">na.omit</span>(dat.cor)
  
  variable &lt;-<span class="st"> </span><span class="ot">NULL</span>
  
  correlation &lt;-<span class="st"> </span><span class="ot">NULL</span>
  
  <span class="cf">if</span>(var<span class="op">==</span><span class="st">&#39;hours.cont&#39;</span>){
    
    inputvar &lt;-<span class="st"> </span><span class="kw">setdiff</span>(varlist, <span class="st">&#39;hours.worked&#39;</span>)
    
    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(inputvar)){
      
      variable[i] &lt;-<span class="st"> </span>inputvar[i]
      
      correlation[i] &lt;-<span class="st"> </span><span class="kw">Lambda</span>(dat.tidy[,<span class="st">&#39;hours.worked&#39;</span>], dat.tidy[,inputvar[i]])
      }
    
    } <span class="cf">else</span>{
      
      inputvar &lt;-<span class="st"> </span><span class="kw">setdiff</span>(varlist, var)
      
      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(inputvar)){
        
        variable[i] &lt;-<span class="st"> </span>inputvar[i]
        
        correlation[i] &lt;-<span class="st"> </span><span class="kw">Lambda</span>(dat.tidy[,var], dat.tidy[,inputvar[i]])
        }
      }
  
  corlist &lt;-<span class="st"> </span><span class="kw">data.frame</span>(variable, correlation)
  
  corlist_high &lt;-<span class="st"> </span>corlist[<span class="kw">order</span>(corlist<span class="op">$</span>correlation, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>),]
  
  corlist_high &lt;-<span class="st"> </span>corlist_high[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,]
  
  CANCEIS.var &lt;-<span class="st"> </span>corlist_high<span class="op">$</span>variable
  
  var_imp &lt;-<span class="st"> </span>dat.miss[,var]
  
  canceis.id &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(dat.miss)
  
  CANCEIS.phase1 &lt;-<span class="st"> </span><span class="kw">cbind</span>(canceis.id, var_imp)
  
  matching &lt;-<span class="st"> </span>dat.miss[, <span class="kw">names</span>(dat.miss) <span class="op">%in%</span><span class="st"> </span>CANCEIS.var]
  
  CANCEIS.input &lt;-<span class="st"> </span><span class="kw">cbind</span>(CANCEIS.phase1, matching)
  
  CANCEIS.input &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">rename</span>(CANCEIS.input, <span class="kw">c</span>(
    <span class="st">&quot;var_imp&quot;</span> =<span class="st"> </span>var))
  
  output &lt;-<span class="st"> </span><span class="kw">list</span>(corlist_high,
                 CANCEIS.input)
  
  <span class="kw">return</span>(output)
  
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Purpose: Create a CANCEIS input dataset with matching variables for a singe imputable variable, using feature importance from XGBoost</span>
<span class="co"># Input: Dataset with multiple auxiliary variables and single imputable variable, along with feature importance from XGBoost model </span>
<span class="co"># Output: Dataset with auxiliary variables (from highest scores feature importance list) and single imputable variable</span>
<span class="co"># Parameters for the function are included below</span>
## dat.miss: Name of dataset with missingness simulated
## var: Name of imputable variable
## featureList: List of features used in XGBoost model with corresponding scores
CANCEISXG &lt;-<span class="st"> </span><span class="cf">function</span>(dat.miss, var, featureList){
  
  featureList &lt;-<span class="st"> </span>featureList[<span class="kw">order</span>(featureList<span class="op">$</span>Cover, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>),]
  
  featureImp &lt;-<span class="st"> </span>featureList[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]
  
  featureSel &lt;-<span class="st"> </span>featureImp<span class="op">$</span>Feature
  
  canceis.id &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(dat.miss)
  
  var_imp &lt;-<span class="st"> </span>dat.miss[,var]
  
  CANCESXG.phase1 &lt;-<span class="st"> </span><span class="kw">cbind</span>(canceis.id, var_imp)
  
  CANCEISXG.matching &lt;-<span class="st"> </span>dat.miss[, featureSel]
  
  CANCEISXG.input &lt;-<span class="st"> </span><span class="kw">cbind</span>(CANCESXG.phase1, CANCEISXG.matching)
  
  CANCEISXG.input &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">rename</span>(CANCEISXG.input, <span class="kw">c</span>(
    <span class="st">&quot;var_imp&quot;</span> =<span class="st"> </span>var))
  
  <span class="kw">return</span>(CANCEISXG.input)
  
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Purpose: Evaluate performance of CANCEIS imputation</span>
<span class="co"># Input: Dataset with CANCEIS imputation </span>
<span class="co"># Output: Metrics to evaluate quality of imputation</span>
<span class="co"># Parameters for the function are included below</span>
## cat: An indicator of whether imputable variable was categorical (=1 if Yes and =0 if No)
## var: Name of imputable variable
## exc: Values of imputable variable to exclude from from evaluating quality of predictions
## actuals: Name of dataset without missingness
## missing: Name of dataset with missingness simulated
## predicted: Name of dataset with imputed values
evalCANCEIS &lt;-<span class="st"> </span><span class="cf">function</span>(cat, var, exc, actuals, missing, predicted){
  
  actuals.CANCEIS &lt;-<span class="st"> </span><span class="kw">subset</span>(actuals, <span class="op">!</span>(<span class="kw">grepl</span>(exc, actuals[,var])), <span class="dt">select =</span> var)
  
  <span class="kw">colnames</span>(actuals.CANCEIS) &lt;-<span class="st"> </span><span class="ot">NULL</span>
  
  missing.CANCEIS &lt;-<span class="st"> </span>missing[, var]
  
  predicted.CANCEIS &lt;-<span class="st"> </span>predicted[, var]
  
  compare_var_CANCEIS &lt;-<span class="st"> </span><span class="kw">tibble</span>(
    <span class="dt">Actuals =</span> actuals.CANCEIS, <span class="dt">Predictions =</span>
      predicted.CANCEIS, <span class="dt">Missing =</span> missing.CANCEIS
  )
  
  compare_missing_CANCEIS &lt;-<span class="st"> </span>compare_var_CANCEIS[
    compare_var_CANCEIS<span class="op">$</span>Missing <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">999</span>, ]
  
  <span class="cf">if</span>(cat<span class="op">==</span><span class="dv">1</span>){
  compare_missing_CANCEIS<span class="op">$</span>indicator &lt;-<span class="st"> </span><span class="kw">ifelse</span>(
    compare_missing_CANCEIS<span class="op">$</span>Actuals[[<span class="dv">1</span>]] <span class="op">==</span>
<span class="st">      </span>compare_missing_CANCEIS<span class="op">$</span>Predictions,
    <span class="st">&quot;Correct&quot;</span>, <span class="st">&quot;Wrong&quot;</span>
  )
  
  counts_CANCEIS &lt;-<span class="st"> </span><span class="kw">table</span>(compare_missing_CANCEIS<span class="op">$</span>indicator)
  
  output &lt;-<span class="st"> </span><span class="kw">list</span>(
    compare_var_CANCEIS,
    compare_missing_CANCEIS,
    counts_CANCEIS
  )
  } <span class="cf">else</span> {

    MAE &lt;-<span class="st"> </span><span class="kw">MAE</span>(compare_missing_CANCEIS<span class="op">$</span>Predictions,compare_missing_CANCEIS<span class="op">$</span>Actuals[[<span class="dv">1</span>]])
    
    RMSE &lt;-<span class="st"> </span><span class="kw">RMSE</span>(compare_missing_CANCEIS<span class="op">$</span>Predictions,compare_missing_CANCEIS<span class="op">$</span>Actuals[[<span class="dv">1</span>]])
    
    output &lt;-<span class="st"> </span><span class="kw">list</span>(
      compare_var_CANCEIS,
      compare_missing_CANCEIS,
      MAE,
      RMSE
    )
    
  }
  <span class="kw">return</span>(output)
  
}</code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>The two rounds of donor based imputation (using CANCEIS) and the model based imputation (XGBoost) were compared using either root mean squared error, absolute error (for continuous variables) and the confusion matrix (for categorical variables).
<ol style="list-style-type: lower-roman">
<li>First, information and data from the previous steps was loaded into working memory<br />
</li>
<li>Next, Each of the methods was evaluated with respect to the performance measure, and compared to either median (for continuous imputation) or mode (for categorical imputation) imputation</li>
</ol></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">XGBoost &lt;-<span class="st"> </span><span class="kw">round</span>(confusion_XGBoost<span class="op">$</span>overall[<span class="kw">c</span>(<span class="st">&#39;Accuracy&#39;</span>,<span class="st">&#39;Kappa&#39;</span>)],<span class="dv">2</span>)

CANCEIS &lt;-<span class="st"> </span><span class="kw">round</span>(confusion_CANCEIS<span class="op">$</span>overall[<span class="kw">c</span>(<span class="st">&#39;Accuracy&#39;</span>,<span class="st">&#39;Kappa&#39;</span>)],<span class="dv">2</span>)

MixedMethods &lt;-<span class="st"> </span><span class="kw">round</span>(confusion_CANCEISXG<span class="op">$</span>overall[<span class="kw">c</span>(<span class="st">&#39;Accuracy&#39;</span>,<span class="st">&#39;Kappa&#39;</span>)],<span class="dv">2</span>)

Mode &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">round</span>(econAct.modmed[[<span class="dv">3</span>]][[<span class="st">&#39;Correct&#39;</span>]]<span class="op">/</span>(econAct.modmed[[<span class="dv">3</span>]][[<span class="st">&#39;Correct&#39;</span>]]<span class="op">+</span>econAct.modmed[[<span class="dv">3</span>]][[<span class="st">&#39;Wrong&#39;</span>]]),<span class="dv">2</span>), <span class="ot">NA</span>)

CompareEconAct &lt;-<span class="st"> </span><span class="kw">cbind</span>(XGBoost, CANCEIS, MixedMethods, Mode)

<span class="kw">save</span>(CompareEconAct, <span class="dt">file =</span> <span class="st">&quot;data/output/CompareEconAct.RData&quot;</span>)</code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="xgboost.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-methods.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["Machine-Learning-in-Imputation.pdf", "Machine-Learning-in-Imputation.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
